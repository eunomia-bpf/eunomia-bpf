FROM ubuntu:22.04

WORKDIR /root

RUN apt-get update --no-install-recommends && \
	apt-get install -y --no-install-recommends libelf1 libelf-dev \
		zlib1g-dev clang llvm libclang-13-dev make cmake git  wget tar && \
	apt-get clean && \
	curl https://sh.rustup.rs -sSf | sh -s	&& \
	rm -rf /var/lib/apt/lists/*	&& \
	apt-get update	&& \
	apt-get install -y ca-certificates	&& \
	update-ca-certificates

COPY . /root/eunomia-bpf
RUN	cd /root/eunomia-bpf && \
	make -C /root/eunomia-bpf bpf-loader	&& \
	make -C /root/eunomia-bpf ecli

RUN	cp /root/eunomia-bpf/ecli/build/bin/Release/ecli /usr/bin/	&& \
	chmod +x /usr/bin/ecli

CMD ["/bin/bash"]